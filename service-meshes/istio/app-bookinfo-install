# ------------------ instructions page -----------------
# https://istio.io/latest/docs/setup/getting-started/#bookinfo

BOOKINFO_CONF=https://raw.githubusercontent.com/istio/istio/release-1.8/samples/bookinfo/platform/kube/bookinfo.yaml
kubectl apply -f ${BOOKINFO_CONF}

# verify bookinfo app is running
kubectl exec "$(kubectl get pod -l app=ratings -o jsonpath='{.items[0].metadata.name}')" -c ratings -- curl -s productpage:9080/productpage | grep -o "<title>.*</title>"

# open bookinfo application to outside traffic
kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.8/samples/bookinfo/networking/bookinfo-gateway.yaml

# validate configuration
istioctl analyze

# open application to outside traffic
kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.8/samples/bookinfo/networking/bookinfo-gateway.yaml

# Determining the ingress IP and ports
kubectl get svc istio-ingressgateway -n istio-system


